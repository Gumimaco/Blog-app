import React,{useState,useEffect,useRef} from "react"
import BlogCard from '../blog/BlogCard'
import axios from 'axios'


const BlogShowcase = () => {
    const [blogs,setBlogs] = useState([])
    const [page,setPage] = useState(1)
    const [lastElement, setLastElement] = useState(null);

    // useEffect(() => {
    //     axios.get('http://localhost:3001/api/blog/last-posts')
    //     .then(data => setBlogs(data.data))
    //     .catch(err => console.log(err))
    // },[blogs])

    const observer = useRef(
        new IntersectionObserver(
            (entries) => {
                console.log("IN OBSERVER",entries)
                const first = entries[0];
                if (first.isIntersecting) {
                    setPage((n) => n + 1);
                }
            })
    );
    
    const getBlogs = async () => {
        let response = await axios.get(
            `http://localhost:3001/api/blog/last-posts/${page}`
        );
        console.log(response.data)
        blogs !== [] ? setBlogs(prev => [...prev,...response.data]) : setBlogs([response.data])
    };
    
    useEffect(() => {
        getBlogs();
    }, [page]);
        
    useEffect(() => {
        const currentElement = lastElement;
        const currentObserver = observer.current;

        if (currentElement) {
            currentObserver.observe(currentElement);
        }

        return () => {
            if (currentElement) {
                currentObserver.unobserve(currentElement);
            }
        };
    }, [lastElement]);

    return (
        <div className="mt-2">
            <div className="flex">
                <div className="flex items-center px-1 hover:bg-white hover:ring-1 hover:ring-blue-600 rounded-md cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg"  className="" viewBox="0 0 50 50" width="15px" height="15px"><path d="M 43.818359 1 C 43.818359 1 40.123579 1.05568 35.705078 2.1894531 C 31.286577 3.3232261 26.037265 5.5288123 22.964844 10.037109 A 1.0001 1.0001 0 0 0 22.917969 10.111328 L 17.890625 19.072266 C 17.365579 19.032769 16.823171 19.002176 16.253906 19 C 12.58418 18.986455 7.4069882 19.879524 3.2050781 25.394531 A 1.0001 1.0001 0 0 0 4 27 L 5.75 27 C 8.069217 27 10.542831 27.382642 12.662109 28.394531 L 12.388672 28.880859 C 11.618752 30.24524 12.047674 32.00006 13.363281 32.857422 L 14.630859 33.699219 C 14.26563 34.081365 13.926117 34.499742 13.623047 34.960938 C 12.469932 36.704369 11.530781 39.342044 11.158203 41.898438 C 10.971914 43.176634 10.929558 44.430474 11.134766 45.560547 C 11.339976 46.690619 11.813645 47.756725 12.763672 48.408203 C 13.711794 49.057477 14.874976 49.104329 15.984375 48.869141 C 17.093774 48.633953 18.217279 48.120531 19.308594 47.460938 C 21.491224 46.141748 23.533325 44.25661 24.685547 42.509766 A 1.0001 1.0001 0 0 0 24.6875 42.505859 C 25.020834 41.995689 25.296025 41.463749 25.513672 40.919922 L 26.378906 41.494141 A 1.0001 1.0001 0 0 0 26.380859 41.494141 C 27.551262 42.265542 29.086872 42.126784 30.103516 41.21875 C 32.32028 43.653078 33.379357 46.52464 34.064453 48.351562 A 1.0001 1.0001 0 0 0 35.796875 48.605469 C 38.291746 45.322744 39 42.258333 39 39 C 39 36.343904 38.107255 34.137089 37.322266 32.464844 L 44.097656 24.183594 A 1.0001 1.0001 0 0 0 44.148438 24.113281 C 46.355421 20.8775 47.018682 17.038588 47 13.494141 C 46.966788 7.1745084 44.763672 1.6328125 44.763672 1.6328125 A 1.0001 1.0001 0 0 0 43.818359 1 z M 43.113281 3.0527344 C 43.452688 3.9736182 44.972343 8.243179 45 13.505859 C 45.01729 16.787078 44.391034 20.198416 42.501953 22.974609 L 28.888672 39.617188 A 1.0001 1.0001 0 0 0 28.886719 39.619141 C 28.55271 40.029061 27.937175 40.123943 27.482422 39.824219 L 14.462891 31.1875 A 1.0001 1.0001 0 0 0 14.455078 31.181641 C 13.991252 30.879421 13.862175 30.336693 14.130859 29.861328 A 1.0001 1.0001 0 0 0 14.132812 29.859375 L 24.630859 11.148438 C 27.271847 7.2877902 32.034596 5.1965842 36.203125 4.1269531 C 39.698935 3.2299396 42.229099 3.0890053 43.113281 3.0527344 z M 33.5 11 C 29.921994 11 27 13.921994 27 17.5 C 27 21.078006 29.921994 24 33.5 24 C 37.078006 24 40 21.078006 40 17.5 C 40 13.921994 37.078006 11 33.5 11 z M 33.5 13 C 35.997126 13 38 15.002874 38 17.5 C 38 19.997126 35.997126 22 33.5 22 C 31.002874 22 29 19.997126 29 17.5 C 29 15.002874 31.002874 13 33.5 13 z M 16.246094 21 C 16.432381 21.000703 16.614267 21.013235 16.798828 21.019531 L 13.642578 26.646484 C 11.31193 25.509754 8.729433 25.112274 6.3105469 25.056641 C 9.7035884 21.648289 13.310085 20.989163 16.246094 21 z M 35.900391 34.203125 C 36.487794 35.599708 37 37.202785 37 39 C 37 41.390251 36.3945 43.475748 35.105469 45.710938 C 34.361404 43.890346 33.339012 41.724891 31.416016 39.683594 L 35.900391 34.203125 z M 16.951172 35.238281 L 23.240234 39.412109 C 22.513638 40.32839 21.21122 41.454434 19.869141 42.177734 C 19.117709 42.582711 18.36213 42.863023 17.746094 42.958984 C 17.130058 43.054944 16.702021 42.974034 16.419922 42.785156 C 16.137318 42.593722 15.901331 42.228225 15.757812 41.623047 C 15.614009 41.016663 15.587924 40.211748 15.679688 39.363281 C 15.84131 37.868792 16.383598 36.263103 16.951172 35.238281 z M 13.632812 39.992188 C 13.607059 40.713214 13.652991 41.419599 13.810547 42.083984 C 14.029212 43.006038 14.482034 43.890431 15.304688 44.445312 A 1.0001 1.0001 0 0 0 15.306641 44.447266 C 16.130542 44.998892 17.118785 45.081335 18.054688 44.935547 C 18.883991 44.806364 19.709315 44.496921 20.509766 44.09375 C 19.803371 44.700938 19.047124 45.283562 18.275391 45.75 C 17.316956 46.329281 16.355852 46.747532 15.570312 46.914062 C 14.784774 47.080593 14.242409 46.997992 13.894531 46.759766 C 13.543058 46.518744 13.249665 46.018709 13.101562 45.203125 C 12.953461 44.387541 12.972255 43.315928 13.136719 42.1875 C 13.242353 41.462707 13.424729 40.722127 13.632812 39.992188 z"/></svg>
                    <div className="pl-1 rounded-md mr-1 font-light">Hot</div>
                </div>
                <div className="flex items-center px-1 hover:bg-white hover:ring-1 hover:ring-blue-600 rounded-md cursor-pointer">
                    <svg fill="#1A1A1A" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="15px" height="15px"><path d="M 24.90625 3.96875 C 24.863281 3.976563 24.820313 3.988281 24.78125 4 C 24.316406 4.105469 23.988281 4.523438 24 5 L 24 11 C 23.996094 11.359375 24.183594 11.695313 24.496094 11.878906 C 24.808594 12.058594 25.191406 12.058594 25.503906 11.878906 C 25.816406 11.695313 26.003906 11.359375 26 11 L 26 5 C 26.011719 4.710938 25.894531 4.433594 25.6875 4.238281 C 25.476563 4.039063 25.191406 3.941406 24.90625 3.96875 Z M 10.65625 9.84375 C 10.28125 9.910156 9.980469 10.183594 9.875 10.546875 C 9.769531 10.914063 9.878906 11.304688 10.15625 11.5625 L 14.40625 15.8125 C 14.648438 16.109375 15.035156 16.246094 15.410156 16.160156 C 15.78125 16.074219 16.074219 15.78125 16.160156 15.410156 C 16.246094 15.035156 16.109375 14.648438 15.8125 14.40625 L 11.5625 10.15625 C 11.355469 9.933594 11.054688 9.820313 10.75 9.84375 C 10.71875 9.84375 10.6875 9.84375 10.65625 9.84375 Z M 39.03125 9.84375 C 38.804688 9.875 38.59375 9.988281 38.4375 10.15625 L 34.1875 14.40625 C 33.890625 14.648438 33.753906 15.035156 33.839844 15.410156 C 33.925781 15.78125 34.21875 16.074219 34.589844 16.160156 C 34.964844 16.246094 35.351563 16.109375 35.59375 15.8125 L 39.84375 11.5625 C 40.15625 11.265625 40.246094 10.800781 40.0625 10.410156 C 39.875 10.015625 39.460938 9.789063 39.03125 9.84375 Z M 24.90625 15 C 24.875 15.007813 24.84375 15.019531 24.8125 15.03125 C 24.75 15.035156 24.6875 15.046875 24.625 15.0625 C 24.613281 15.074219 24.605469 15.082031 24.59375 15.09375 C 19.289063 15.320313 15 19.640625 15 25 C 15 30.503906 19.496094 35 25 35 C 30.503906 35 35 30.503906 35 25 C 35 19.660156 30.746094 15.355469 25.46875 15.09375 C 25.433594 15.09375 25.410156 15.0625 25.375 15.0625 C 25.273438 15.023438 25.167969 15.003906 25.0625 15 C 25.042969 15 25.019531 15 25 15 C 24.96875 15 24.9375 15 24.90625 15 Z M 24.9375 17 C 24.957031 17 24.980469 17 25 17 C 25.03125 17 25.0625 17 25.09375 17 C 29.46875 17.050781 33 20.613281 33 25 C 33 29.421875 29.421875 33 25 33 C 20.582031 33 17 29.421875 17 25 C 17 20.601563 20.546875 17.035156 24.9375 17 Z M 4.71875 24 C 4.167969 24.078125 3.78125 24.589844 3.859375 25.140625 C 3.9375 25.691406 4.449219 26.078125 5 26 L 11 26 C 11.359375 26.003906 11.695313 25.816406 11.878906 25.503906 C 12.058594 25.191406 12.058594 24.808594 11.878906 24.496094 C 11.695313 24.183594 11.359375 23.996094 11 24 L 5 24 C 4.96875 24 4.9375 24 4.90625 24 C 4.875 24 4.84375 24 4.8125 24 C 4.78125 24 4.75 24 4.71875 24 Z M 38.71875 24 C 38.167969 24.078125 37.78125 24.589844 37.859375 25.140625 C 37.9375 25.691406 38.449219 26.078125 39 26 L 45 26 C 45.359375 26.003906 45.695313 25.816406 45.878906 25.503906 C 46.058594 25.191406 46.058594 24.808594 45.878906 24.496094 C 45.695313 24.183594 45.359375 23.996094 45 24 L 39 24 C 38.96875 24 38.9375 24 38.90625 24 C 38.875 24 38.84375 24 38.8125 24 C 38.78125 24 38.75 24 38.71875 24 Z M 15 33.875 C 14.773438 33.90625 14.5625 34.019531 14.40625 34.1875 L 10.15625 38.4375 C 9.859375 38.679688 9.722656 39.066406 9.808594 39.441406 C 9.894531 39.8125 10.1875 40.105469 10.558594 40.191406 C 10.933594 40.277344 11.320313 40.140625 11.5625 39.84375 L 15.8125 35.59375 C 16.109375 35.308594 16.199219 34.867188 16.039063 34.488281 C 15.882813 34.109375 15.503906 33.867188 15.09375 33.875 C 15.0625 33.875 15.03125 33.875 15 33.875 Z M 34.6875 33.875 C 34.3125 33.941406 34.011719 34.214844 33.90625 34.578125 C 33.800781 34.945313 33.910156 35.335938 34.1875 35.59375 L 38.4375 39.84375 C 38.679688 40.140625 39.066406 40.277344 39.441406 40.191406 C 39.8125 40.105469 40.105469 39.8125 40.191406 39.441406 C 40.277344 39.066406 40.140625 38.679688 39.84375 38.4375 L 35.59375 34.1875 C 35.40625 33.988281 35.148438 33.878906 34.875 33.875 C 34.84375 33.875 34.8125 33.875 34.78125 33.875 C 34.75 33.875 34.71875 33.875 34.6875 33.875 Z M 24.90625 37.96875 C 24.863281 37.976563 24.820313 37.988281 24.78125 38 C 24.316406 38.105469 23.988281 38.523438 24 39 L 24 45 C 23.996094 45.359375 24.183594 45.695313 24.496094 45.878906 C 24.808594 46.058594 25.191406 46.058594 25.503906 45.878906 C 25.816406 45.695313 26.003906 45.359375 26 45 L 26 39 C 26.011719 38.710938 25.894531 38.433594 25.6875 38.238281 C 25.476563 38.039063 25.191406 37.941406 24.90625 37.96875 Z"/></svg>
                    <button className="pl-1 rounded-md mr-1 font-light">New</button>
                </div>
                <div className="flex items-center px-1 hover:bg-white hover:ring-1 hover:ring-blue-600 rounded-md cursor-pointer">
                    <svg fill="#1A1A1A" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" width="15px" height="15px"><path d="M 25.013672 2 A 1.0001 1.0001 0 0 0 24.257812 2.3203125 L 17.041016 10.107422 L 7.1152344 12.443359 L 2.4375 10.105469 A 1.0001 1.0001 0 0 0 1.9550781 10 A 1.0001 1.0001 0 0 0 1.0957031 10.552734 C 1.0957031 10.552734 -0.009765625 12.809524 -0.009765625 16.5 C -0.009765625 18.41826 0.56640439 19.857705 1.2167969 21.027344 A 1.0001 1.0001 0 0 0 -0.009765625 22 L -0.009765625 23 C -0.009765625 24.117325 -0.15578083 26.755937 0.59179688 29.355469 C 1.3369967 31.946731 3.1381649 34.621043 6.7324219 35.464844 A 1.0001 1.0001 0 0 0 6.7617188 35.472656 C 6.7631417 35.472985 6.7642015 35.474281 6.765625 35.474609 L 8.5742188 35.900391 L 8.0332031 37.714844 C 7.9542031 37.978844 7.987 38.260047 8.125 38.498047 C 8.262 38.736047 8.4908125 38.907656 8.7578125 38.972656 L 17.853516 41.15625 L 24.277344 47.701172 C 24.465344 47.892172 24.723187 48.001953 24.992188 48.001953 C 25.261187 48.001953 25.516078 47.893172 25.705078 47.701172 L 32.130859 41.15625 L 41.226562 38.972656 C 41.493563 38.908656 41.722375 38.737047 41.859375 38.498047 C 41.997375 38.260047 42.030172 37.978844 41.951172 37.714844 L 41.408203 35.900391 L 43.216797 35.474609 C 46.834018 34.639866 48.641094 31.955 49.388672 29.355469 C 50.13625 26.755937 49.990234 24.117325 49.990234 23 L 49.990234 22 A 1.0001 1.0001 0 0 0 48.765625 21.025391 C 49.415535 19.85598 49.990234 18.417198 49.990234 16.5 C 49.990234 12.809524 48.884766 10.552734 48.884766 10.552734 A 1.0001 1.0001 0 0 0 47.998047 10 A 1.0001 1.0001 0 0 0 47.542969 10.105469 L 42.865234 12.443359 L 32.939453 10.107422 L 25.724609 2.3203125 A 1.0001 1.0001 0 0 0 25.013672 2 z M 24.990234 4.4707031 L 31.679688 11.689453 A 1.0001 1.0001 0 0 0 32.185547 11.982422 L 41.728516 14.228516 L 38.878906 23.712891 A 1.0001 1.0001 0 0 0 38.878906 24.287109 L 41.728516 33.771484 L 32.185547 36.017578 A 1.0001 1.0001 0 0 0 31.679688 36.310547 L 24.990234 43.529297 L 18.300781 36.310547 A 1.0001 1.0001 0 0 0 17.796875 36.017578 L 8.2539062 33.771484 L 11.103516 24.287109 A 1.0001 1.0001 0 0 0 11.103516 23.712891 L 8.2539062 14.228516 L 17.796875 11.982422 A 1.0001 1.0001 0 0 0 18.300781 11.689453 L 24.990234 4.4707031 z M 24.990234 12 C 18.374662 12 12.990234 17.384428 12.990234 24 L 12.990234 24.003906 C 12.990286 24.021343 12.992057 24.039188 12.992188 24.056641 C 13.023167 30.645979 18.39377 36 24.990234 36 C 31.203549 36 36.329127 31.249683 36.929688 25.191406 C 36.971482 24.792308 36.991286 24.39382 36.990234 24 C 36.990234 17.384428 31.605807 12 24.990234 12 z M 2.5527344 12.400391 L 6.1582031 14.201172 L 9.1015625 24 L 6.3222656 33.253906 C 4.0826869 32.432768 3.0712112 30.739498 2.5136719 28.800781 C 1.9339775 26.785026 1.9840046 24.699085 1.9941406 23.388672 L 3.6738281 23.949219 A 1.0001 1.0001 0 0 0 4.5683594 22.183594 C 4.5683594 22.183594 1.9902344 20.417857 1.9902344 16.5 C 1.9902344 14.417844 2.2901435 13.19856 2.5527344 12.400391 z M 47.427734 12.400391 C 47.690325 13.19856 47.990234 14.417844 47.990234 16.5 C 47.990234 20.417857 45.412109 22.183594 45.412109 22.183594 A 1.0001 1.0001 0 0 0 46.306641 23.949219 L 47.986328 23.388672 C 47.996468 24.699085 48.046488 26.785027 47.466797 28.800781 C 46.909258 30.739498 45.899392 32.432768 43.660156 33.253906 L 40.880859 24 L 43.824219 14.201172 L 47.427734 12.400391 z M 24.990234 14 C 30.524927 14 34.990234 18.465308 34.990234 24 C 34.990234 25.166544 34.78095 26.280577 34.416016 27.320312 C 33.829851 28.725236 32.703653 29.971493 30.576172 30.96875 A 1.0001 1.0001 0 0 0 30.001953 31.802734 L 29.994141 31.927734 A 1.0001 1.0001 0 0 0 29.990234 32 C 29.990234 32.56503 29.555265 33 28.990234 33 L 20.990234 33 C 20.42841 33 19.999039 32.56816 19.994141 32.007812 L 19.998047 31.947266 A 1.0001 1.0001 0 0 0 19.423828 30.96875 C 17.19697 29.924911 16.056582 28.609448 15.492188 27.121094 C 15.170875 26.138782 14.990234 25.09155 14.990234 24 L 14.990234 23.998047 L 14.990234 23.996094 C 14.992359 18.463228 19.456859 14 24.990234 14 z M 21.980469 18.990234 A 1.0001 1.0001 0 0 0 21.283203 20.707031 L 22.283203 21.707031 A 1.0001 1.0001 0 1 0 23.697266 20.292969 L 22.697266 19.292969 A 1.0001 1.0001 0 0 0 21.980469 18.990234 z M 27.970703 18.990234 A 1.0001 1.0001 0 0 0 27.283203 19.292969 L 26.283203 20.292969 A 1.0001 1.0001 0 1 0 27.697266 21.707031 L 28.697266 20.707031 A 1.0001 1.0001 0 0 0 27.970703 18.990234 z M 19.990234 22 A 3 3 0 0 0 16.990234 25 A 3 3 0 0 0 19.990234 28 A 3 3 0 0 0 22.990234 25 A 3 3 0 0 0 19.990234 22 z M 29.990234 22 A 3 3 0 0 0 26.990234 25 A 3 3 0 0 0 29.990234 28 A 3 3 0 0 0 32.990234 25 A 3 3 0 0 0 29.990234 22 z M 24.990234 26 L 22.990234 29 L 26.990234 29 L 24.990234 26 z"/></svg>
                    <button className="pl-1 rounded-md mr-1 font-light">Top</button>
                </div>
            </div>
            { blogs ? blogs.map((blog,index) => {
                    return index === blogs.length - 1 ? <div ref={setLastElement}><BlogCard blog={blog} key={index}/></div> : <BlogCard blog={blog} key={index}/>
                }) : null
            }
        </div>
    )
};

export default BlogShowcase;